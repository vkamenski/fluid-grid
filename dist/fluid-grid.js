define("fluid-grid/image-loader",[],function(){var e=new Array,t=!1,n=function(){var r=e.shift();if(r){t=!0;var i=r.image.data("src");r.image.on("load",function(){r.def.resolve(r.image),n()}).on("error",function(){r.def.reject(r.image),n()}).attr("src",i)}else t=!1},r=function(t){var n=$.Deferred();return e.push({def:n,image:$(t)}),n.promise()};return{load:function(e){var i=r(e);return t||n(),i}}}),define("fluid-grid/mixins/data-options",[],function(){return{optionsPrefix:"",parseOptions:function(){var e=this,t=this.$el.data()||{},n=new RegExp("^"+this.optionsPrefix+"([a-zA-Z]+)");return $.each(t,function(r,i){t.hasOwnProperty(r)&&n.test(r)&&(shortName=r.match(n)[1].replace(/[A-Z]/,function(e){return(e||"").toLowerCase()}),e.options[shortName]=i)}),this}}}),define("fluid-grid/item",["backbone","fluid-grid/image-loader","fluid-grid/mixins/data-options"],function(e,t,n){var r=e.View.extend({optionsPrefix:"fluidGrid",initialize:function(){this.parseOptions()},resize:function(e,t){var n=e.width-this.getOffset();this.$el.width(Math.floor(n));if(t){var r=n*this.getAspectRation();this.$el.height(Math.floor(r))}return this},getOffset:function(){var e=this.$el.outerWidth(!0)-this.$el.width();return e},getAspectRation:function(){return this.options.height/this.options.width},position:function(e){return this.$el.css({top:e.top||0,left:e.left||0}),this},render:function(){var e=this;return this.$el.css("position","absolute"),this.$el.find("img").each(function(n,r){t.load(r).then(function(t){e.$el.removeClass("loading")})}),this}});return _.extend(r.prototype,n),r}),define("fluid-grid",["fluid-grid/item","backbone","fluid-grid/mixins/data-options"],function(e,t,n){var r=t.View.extend({optionsPrefix:"fluidGrid",options:{itemSelector:"> .item",columnMaxWidth:300,columnMinWidth:200,keepAspectRetio:!0},columns:{},items:[],initialize:function(){var e=this;this.parseOptions(),this.$el.find(this.options.itemSelector).each(function(t,n){e.addItem(n)}),$(window).resize(function(){e.render()})},addItem:function(t){var n=new e({el:$(t)});return this.items.push(n),this.$el.append(n.el),this.$el.trigger("item-added.fluid-grid",[n]),this},getColumnsCount:function(){var e=Math.ceil(this.width/(this.options.columnMaxWidth+this.getItemsOffset()));return e>this.items.length&&(e=this.items.length),e},getColumnWidth:function(){var e=this.width/this.getColumnsCount();return e>this.options.columnMaxWidth&&(e=this.options.columnMaxWidth),e},getItemsOffset:function(){var e=0;return this.items[0]&&(e=this.items[0].getOffset()),e},findSmallestColumn:function(){var e=null;return $.each(this.columns,function(t,n){if(!e||e.height>n.height)e=n}),e},findHighestColumn:function(){var e=null;return $.each(this.columns,function(t,n){if(!e||e.height<n.height)e=n}),e},createColumns:function(){this.columns={};for(var e=1;e<=this.getColumnsCount();e++)this.columns[e]={sort:e,height:0}},render:function(){var e=this;this.width=this.$el.width(),this.$el.css({position:"relative",visibility:"visible"}),this.createColumns(),$.each(this.items,function(t,n){var r=e.findSmallestColumn();n.render().resize({width:e.getColumnWidth()},e.options.keepAspectRetio),n.position({top:r.height,left:(r.sort-1)*e.getColumnWidth()}),r.height+=n.$el.outerHeight(!0)});var t=this.findHighestColumn();return t&&this.$el.height(t.height),this}});return _.extend(r.prototype,n),r});